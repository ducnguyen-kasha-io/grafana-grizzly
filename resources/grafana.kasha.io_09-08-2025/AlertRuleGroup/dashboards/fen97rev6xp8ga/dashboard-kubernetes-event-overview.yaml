apiVersion: grizzly.grafana.com/v1alpha1
kind: Dashboard
metadata:
    folder: fen97rev6xp8ga
    name: kubernetes-event-overview
spec:
    annotations:
        list:
            - builtIn: 1
              datasource:
                type: datasource
                uid: grafana
              enable: true
              hide: true
              iconColor: rgba(0, 211, 255, 1)
              name: Annotations & Alerts
              target:
                limit: 100
                matchAny: false
                tags: []
                type: dashboard
              type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 0
    links: []
    panels:
        - collapsed: false
          gridPos:
            h: 1
            w: 24
            x: 0
            "y": 0
          id: 34
          panels: []
          title: Kubernetes Events - Details
          type: row
        - datasource:
            type: loki
            uid: ${datasource}
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    axisBorderShow: false
                    axisCenteredZero: false
                    axisColorMode: text
                    axisLabel: ""
                    axisPlacement: left
                    barAlignment: 0
                    barWidthFactor: 0.6
                    drawStyle: bars
                    fillOpacity: 100
                    gradientMode: none
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                    insertNulls: false
                    lineInterpolation: linear
                    lineWidth: 1
                    pointSize: 5
                    scaleDistribution:
                        type: linear
                    showPoints: auto
                    spanNulls: false
                    stacking:
                        group: A
                        mode: normal
                    thresholdsStyle:
                        mode: "off"
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 8
            w: 24
            x: 0
            "y": 1
          id: 2
          interval: 1m
          options:
            legend:
                calcs: []
                displayMode: list
                placement: bottom
                showLegend: true
            tooltip:
                hideZeros: false
                mode: single
                sort: none
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: code
              expr: sum by (type) (count_over_time({source="kubernetes-events"} | logfmt | __error__=`` | metadata_namespace=~`$namespace` [$__interval]))
              legendFormat: '{{type}}'
              queryType: range
              refId: A
          title: Overview
          type: timeseries
        - datasource:
            type: loki
            uid: ${datasource}
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    filterable: true
                    inspect: false
                    minWidth: 65
                links: []
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
            overrides:
                - matcher:
                    id: byName
                    options: labels
                  properties:
                    - id: custom.filterable
                    - id: custom.inspect
                      value: true
                - matcher:
                    id: byName
                    options: type
                  properties:
                    - id: mappings
                      value:
                        - options:
                            Normal:
                                color: text
                                index: 1
                            Warning:
                                color: red
                                index: 0
                          type: value
                    - id: custom.cellOptions
                      value:
                        type: color-text
                    - id: custom.width
                      value: 66
                - matcher:
                    id: byName
                    options: message
                  properties:
                    - id: custom.minWidth
                      value: 280
                - matcher:
                    id: byName
                    options: involvedObject_name
                  properties:
                    - id: custom.minWidth
                      value: 245
                - matcher:
                    id: byName
                    options: count
                  properties:
                    - id: custom.width
                      value: 55
                - matcher:
                    id: byType
                    options: time
                  properties:
                    - id: custom.filterable
                      value: false
                    - id: unit
                      value: dateTimeFromNow
                - matcher:
                    id: byName
                    options: lastTimestamp
                  properties:
                    - id: custom.filterable
                - matcher:
                    id: byName
                    options: Full event
                  properties:
                    - id: custom.width
                      value: 163
                - matcher:
                    id: byName
                    options: Count
                  properties:
                    - id: custom.width
                      value: 206
                - matcher:
                    id: byName
                    options: Type
                  properties:
                    - id: custom.width
                      value: 149
                - matcher:
                    id: byName
                    options: msg
                  properties:
                    - id: custom.width
                      value: 474
                - matcher:
                    id: byName
                    options: Time
                  properties:
                    - id: custom.width
                - matcher:
                    id: byName
                    options: Message
                  properties:
                    - id: custom.width
                      value: 355
          gridPos:
            h: 13
            w: 24
            x: 0
            "y": 9
          id: 36
          options:
            cellHeight: sm
            footer:
                countRows: false
                enablePagination: true
                fields: ""
                reducer:
                    - sum
                show: false
            showHeader: true
            sortBy:
                - desc: false
                  displayName: Time
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: code
              expr: ' {source="kubernetes-events"} |~ `(?i)$contains` | logfmt | __error__=`` | metadata_namespace=~`$namespace`'
              queryType: range
              refId: A
          title: Events Details
          transformations:
            - id: extractFields
              options:
                replace: false
                source: labels
            - id: filterFieldsByName
              options:
                byVariable: true
                include:
                    names:
                        - Time
                        - count
                        - msg
                        - name
                        - namespace
                        - sourcecomponent
                        - sourcehost
                        - type
                    pattern: /^(labels|type|message|metadata_namespace|involvedObject_kind|involvedObject_name|source_component|count|metadata_creationTimestamp|firstTimestamp|lastTimestamp)$/
            - id: organize
              options:
                excludeByName:
                    count: true
                    firstTimestamp: true
                    labels: true
                    sourcecomponent: true
                    sourcehost: true
                includeByName: {}
                indexByName:
                    Time: 3
                    count: 4
                    labels: 0
                    msg: 2
                    name: 5
                    namespace: 6
                    sourcecomponent: 7
                    sourcehost: 8
                    type: 1
                renameByName:
                    Time: ""
                    count: Count
                    firstTimestamp: Age
                    involvedObject_kind: Kind
                    involvedObject_name: Involved Object
                    labels: Full event
                    lastTimestamp: Last Seen
                    message: Message
                    metadata_creationTimestamp: Created
                    metadata_namespace: Namespace
                    msg: Message
                    name: 'Service '
                    namespace: Namespace
                    source_component: Source
                    type: Type
            - id: convertFieldType
              options:
                conversions:
                    - destinationType: time
                      targetField: metadata_creationTimestamp
                fields: {}
            - id: sortBy
              options:
                fields: {}
                sort:
                    - desc: true
                      field: Last Seen
          type: table
        - collapsed: false
          gridPos:
            h: 1
            w: 24
            x: 0
            "y": 22
          id: 32
          panels: []
          title: Kubernetes Events - Stats
          type: row
        - datasource:
            type: loki
            uid: ${datasource}
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    filterable: false
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                        - color: red
                          value: 0
            overrides:
                - matcher:
                    id: byName
                    options: Field
                  properties:
                    - id: custom.align
                      value: center
                    - id: custom.width
                      value: 300
                    - id: color
                      value:
                        mode: thresholds
                    - id: displayName
                      value: Reason
                    - id: custom.cellOptions
                      value:
                        mode: gradient
                        type: color-background
                    - id: color
                      value:
                        fixedColor: semi-dark-blue
                        mode: fixed
                - matcher:
                    id: byName
                    options: Total
                  properties:
                    - id: custom.cellOptions
                      value:
                        mode: gradient
                        type: gauge
                    - id: color
                      value:
                        mode: continuous-BlPu
                    - id: custom.align
                      value: center
          gridPos:
            h: 11
            w: 24
            x: 0
            "y": 23
          id: 37
          interval: 1m
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: false
            frameIndex: 1
            showHeader: true
            sortBy:
                - desc: true
                  displayName: Total
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: builder
              expr: topk(10, sum by(reason) (count_over_time({source="kubernetes-events"} | logfmt | __error__=`` [$__interval])))
              instant: false
              legendFormat: '{{reason}}'
              queryType: range
              range: true
              refId: A
          title: TOP 10  Kubernetes Events
          transformations:
            - id: reduce
              options:
                reducers:
                    - sum
          transparent: true
          type: table
        - datasource:
            type: loki
            uid: ${datasource}
          description: ""
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                mappings: []
            overrides:
                - matcher:
                    id: byName
                    options: Field
                  properties:
                    - id: color
                      value:
                        mode: thresholds
                    - id: displayName
                      value: Reason
                    - id: color
                      value:
                        fixedColor: '#eab839'
                        mode: fixed
                - matcher:
                    id: byName
                    options: Total
                  properties:
                    - id: color
                      value:
                        mode: continuous-BlYlRd
                - __systemRef: hideSeriesFrom
                  matcher:
                    id: byNames
                    options:
                        mode: exclude
                        names:
                            - Completed
                            - Created
                            - FreeDiskSpaceFailed
                            - InProgress
                            - JobAlreadyActive
                            - Killing
                            - Pulled
                            - Pulling
                            - SawCompletedJob
                            - Scheduled
                            - SnapshotDelete
                            - SnapshotError
                            - SnapshotUpdate
                            - Started
                            - SuccessfulCreate
                            - SuccessfulDelete
                            - Unhealthy
                            - Valid
                            - nodeAssigned
                            - unchanged
                            - Value
                        prefix: 'All except:'
                        readOnly: true
                  properties:
                    - id: custom.hideFrom
                      value:
                        legend: false
                        tooltip: false
                        viz: true
          gridPos:
            h: 14
            w: 6
            x: 0
            "y": 34
          id: 26
          interval: 1m
          options:
            legend:
                displayMode: list
                placement: bottom
                showLegend: true
            pieType: pie
            reduceOptions:
                calcs:
                    - sum
                fields: ""
                values: false
            tooltip:
                hideZeros: false
                mode: multi
                sort: none
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: code
              expr: sum by (reason) (count_over_time({source="kubernetes-events"} | logfmt | __error__=``  [$__interval]))
              instant: false
              legendFormat: '{{reason}}'
              queryType: range
              range: true
              refId: A
          title: Events by Reason
          type: piechart
        - datasource:
            type: loki
            uid: ${datasource}
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                mappings: []
            overrides:
                - __systemRef: hideSeriesFrom
                  matcher:
                    id: byNames
                    options:
                        mode: exclude
                        names:
                            - cert-manager
                            - deployments
                            - eck
                            - flux-system
                            - observability-client
                            - prod-lr
                            - prod-payments
                            - Value
                        prefix: 'All except:'
                        readOnly: true
                  properties:
                    - id: custom.hideFrom
                      value:
                        legend: false
                        tooltip: false
                        viz: true
          gridPos:
            h: 14
            w: 6
            x: 6
            "y": 34
          id: 28
          interval: 1m
          options:
            displayLabels: []
            legend:
                displayMode: list
                placement: bottom
                showLegend: true
            pieType: pie
            reduceOptions:
                calcs:
                    - sum
                fields: ""
                values: false
            tooltip:
                hideZeros: false
                mode: multi
                sort: none
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: code
              expr: sum by (namespace) (count_over_time({source="kubernetes-events"} | logfmt | __error__=`` [$__interval]))
              legendFormat: '{{metadata_namespace}}'
              queryType: range
              range: true
              refId: A
          title: Events by Namespace
          type: piechart
        - datasource:
            type: loki
            uid: ${datasource}
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                mappings: []
            overrides: []
          gridPos:
            h: 14
            w: 6
            x: 12
            "y": 34
          id: 20
          interval: 1m
          options:
            legend:
                displayMode: list
                placement: bottom
                showLegend: true
            pieType: pie
            reduceOptions:
                calcs:
                    - sum
                fields: ""
                values: false
            tooltip:
                hideZeros: false
                mode: multi
                sort: none
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: code
              expr: sum by (sourcecomponent) (count_over_time({source="kubernetes-events"}| logfmt | __error__=`` | metadata_namespace=~`$namespace` [$__interval]))
              legendFormat: '{{source_component}}'
              queryType: range
              range: true
              refId: A
          title: Events by Source
          type: piechart
        - datasource:
            type: loki
            uid: ${datasource}
          fieldConfig:
            defaults:
                color:
                    mode: palette-classic
                custom:
                    hideFrom:
                        legend: false
                        tooltip: false
                        viz: false
                links: []
                mappings: []
            overrides: []
          gridPos:
            h: 14
            w: 6
            x: 18
            "y": 34
          id: 22
          interval: 1m
          options:
            legend:
                displayMode: list
                placement: bottom
                showLegend: true
                values: []
            pieType: pie
            reduceOptions:
                calcs:
                    - sum
                fields: ""
                values: false
            tooltip:
                hideZeros: false
                mode: multi
                sort: none
          pluginVersion: 11.6.0
          targets:
            - datasource:
                type: loki
                uid: ${datasource}
              direction: backward
              editorMode: code
              expr: sum by (kind) (count_over_time({source="kubernetes-events"} | logfmt | __error__=`` [$__interval]))
              legendFormat: '{{involvedObject_kind}}'
              queryType: range
              range: true
              refId: A
          title: Events by Kind
          type: piechart
    preload: false
    refresh: 10s
    schemaVersion: 41
    tags:
        - kasha
    templating:
        list:
            - current:
                text: logs-gke-prod-kasha
                value: felmlj6wx3i80e
              includeAll: false
              label: datasource
              name: datasource
              options: []
              query: loki
              refresh: 1
              regex: ""
              type: datasource
            - allValue: .*
              current:
                text: All
                value:
                    - $__all
              datasource:
                type: loki
                uid: ${datasource}
              definition: ""
              includeAll: true
              multi: true
              name: namespace
              options: []
              query:
                label: namespace
                refId: LokiVariableQueryEditor-VariableQuery
                stream: ""
                type: 1
              refresh: 2
              regex: ""
              sort: 5
              type: query
            - current:
                text: ""
                value: ""
              description: Line contains case insensitive. Return log lines that match regex (?i)
              label: Search events
              name: contains
              options:
                - selected: true
                  text: ""
                  value: ""
              query: ""
              type: textbox
    time:
        from: now-6h
        to: now
    timepicker:
        refresh_intervals:
            - 10s
            - 30s
            - 1m
            - 5m
            - 15m
            - 30m
            - 1h
            - 2h
            - 1d
    timezone: ""
    title: Kubernetes Event Overview
    uid: kubernetes-event-overview
