apiVersion: grizzly.grafana.com/v1alpha1
kind: Dashboard
metadata:
    folder: fds3wc5k1wkcgb
    name: edstoqgxtbrb4f
spec:
    annotations:
        list:
            - builtIn: 1
              datasource:
                type: grafana
                uid: -- Grafana --
              enable: true
              hide: true
              iconColor: rgba(0, 211, 255, 1)
              name: Annotations & Alerts
              type: dashboard
    editable: true
    fiscalYearStartMonth: 0
    graphTooltip: 0
    links: []
    panels:
        - datasource:
            type: haohanyang-mongodb-datasource
            uid: feu6yxrhwnrpca
          fieldConfig:
            defaults:
                color:
                    mode: thresholds
                custom:
                    align: auto
                    cellOptions:
                        type: auto
                    filterable: true
                    inspect: false
                mappings: []
                thresholds:
                    mode: absolute
                    steps:
                        - color: green
                        - color: red
                          value: 80
            overrides: []
          gridPos:
            h: 13
            w: 24
            x: 0
            "y": 0
          id: 1
          options:
            cellHeight: sm
            footer:
                countRows: false
                fields: ""
                reducer:
                    - sum
                show: false
            showHeader: true
            sortBy: []
          pluginVersion: 11.6.4
          targets:
            - collection: transactions
              datasource:
                type: haohanyang-mongodb-datasource
                uid: feu6yxrhwnrpca
              isStreaming: false
              queryLanguage: json
              queryText: "[\r\n  {\r\n    \"$match\": {\r\n      \"$expr\": {\r\n        \"$and\": [\r\n          { \"$lte\": [\"$createdAt\", { \"$date\": { \"$numberLong\": \"$__to\" } }] },\r\n          { \"$eq\": [\"$status\", \"COMPLETED\"] }\r\n        ]\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$addFields\": {\r\n      \"createdAtDay\": {\r\n        \"$dateToString\": {\r\n          \"format\": \"%Y-%m-%d\",\r\n          \"date\": \"$createdAt\"\r\n        }\r\n      },\r\n      \"fxAmount\": \"$fx.amount\",\r\n      \"ftdInfo\": {\r\n        \"$cond\": {\r\n          \"if\": \"$cardStats.ftd\",\r\n          \"then\": \"FTD\",\r\n          \"else\": \"Secondary Traffic\"\r\n        }\r\n      },\r\n      \"merchantId\": \"$merchantId\"\r\n    }\r\n  },\r\n  {\r\n    \"$group\": {\r\n      \"_id\": {\r\n        \"createdAtDay\": \"$createdAtDay\",\r\n        \"merchantId\": \"$merchantId\"\r\n      },\r\n      \"totalAmount\": {\r\n        \"$sum\": \"$fxAmount\"\r\n      },\r\n      \"ftdInfo\": {\r\n        \"$first\": \"$ftdInfo\"\r\n      }\r\n    }\r\n  },\r\n  {\r\n    \"$lookup\": {\r\n      \"from\": \"merchants\",\r\n      \"localField\": \"_id.merchantId\",\r\n      \"foreignField\": \"_id\",\r\n      \"as\": \"merchantDetails\"\r\n    }\r\n  },\r\n  {\r\n    \"$unwind\": \"$merchantDetails\"\r\n  },\r\n  {\r\n    \"$project\": {\r\n      \"_id\": 0,\r\n      \"createdAtDay\": \"$_id.createdAtDay\",\r\n      \"merchantName\": \"$merchantDetails.name\",\r\n      \"fxAmount\": \"$totalAmount\",\r\n      \"ftdInfo\": 1\r\n    }\r\n  }\r\n]"
              queryType: table
              refId: A
          title: FTD
          type: table
    preload: false
    refresh: ""
    schemaVersion: 41
    tags: []
    templating:
        list: []
    time:
        from: now-6h
        to: now
    timepicker: {}
    timezone: browser
    title: FTD
    uid: edstoqgxtbrb4f
